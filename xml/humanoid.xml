<rosiml version="0.8.41">
  <simulator frequency="100">
    <solver  iterations="10"/>
  </simulator>

  <screens>
    <screen name="Muscle actuators - Humanoid" show="true" follow="false">
      <resolution name="1080p"/>
      <camera>
        <!-- Presentation View -->
        <position x="-2.5" y="-1.8" z="1.0"/>
        <lookAt x="0.0" y="0.00" z="0.5"/>
        <!-- Front View -->
        <!-- <position x="-2.0" y="0" z="0.5"/> -->
        <!-- <lookAt x="0.0" y="0.00" z="0.5"/> -->
        <!-- Side View -->
        <!-- <position x="0" y="-2.5" z="0.5"/> -->
        <!-- <lookAt x="0.0" y="0.00" z="0.5"/> -->
      </camera>
      <osd>
        <time  font="Time"  size="25" colour="FFFF00"/>
        <robot font="Robot" size="25" colour="FFFFFF"/>
      </osd>
    </screen>

    <sky name="YARS/CloudySky"/>

    <visualise>
      <joints />
    </visualise>
  </screens>

  <environment>
    <ground fixed="true" fog="false">
      <visualisation>
        <texture name="YARS/DryGroundSmall"/>
      </visualisation>
    </ground>
  </environment>

  <robots>
    <robot name="Humanoid">
      <body>
        <cylinder name="hip" visualise="true">
          <dimension radius="0.1" height="0.394"/>
          <pose x="0" y="0" z="1.055" alpha="90" beta="0" gamma="0"/>
          <physics>
            <mass kg="0"/>
          </physics>
        </cylinder>

        <!-- TODO: Set correct mass. -->
        <!-- TODO: Set centre of mass? -->
        <cylinder name="thigh_left" visualise="true">
          <dimension radius="0.02" height="0.422"/> <!-- -20mm for joint space. -->
          <pose x="0" y="-0.172" z="0.734" alpha="0" gamma="0"/>
          <physics>
            <mass kg="10"/>
            <!--<centreOfMass x="0" y="0" z="0">-->
          </physics>
        </cylinder>
        <cylinder name="shank_left" visualise="true">
          <dimension radius="0.02" height="0.423"/> <!-- -20mm for joint space. -->
          <pose x="0" y="-0.172" z="0.2915" alpha="0" gamma="0"/>
          <physics>
            <mass kg="5"/>
            <!--<centreOfMass x="0" y="0" z="0">-->
          </physics>
        </cylinder>
        <box name="foot_left">
          <dimension height="0.03" width="0.0991" depth="0.2738"/>
          <pose x="-0.1" y="-0.172" z="0" alpha="0" gamma="90"/>
          <physics>
            <mass kg="2"/>
            <!--<centreOfMass x="0" y="0" z="0">-->
          </physics>
        </box>

        <!--<cylinder name="thigh_right" visualise="true">-->
        <!--<dimension radius="0.02" height="0.42"/>-->
        <!--<pose x="0" y="0.2" z="0.68" alpha="0" beta="0" gamma="0"/>-->
        <!--<physics>-->
        <!--<mass kg="0"/>-->
        <!--</physics>-->
        <!--</cylinder>-->
        <!--<cylinder name="shank_right" visualise="true">-->
        <!--<dimension radius="0.02" height="0.38"/>-->
        <!--<pose x="0" y="0.2" z="0.23" alpha="0" beta="0" gamma="0"/>-->
        <!--<physics>-->
        <!--<mass kg="0"/>-->
        <!--</physics>-->
        <!--</cylinder>-->
        <!--<box name="foot_right">-->
        <!--<dimension height="0.01" width="0.1" depth="0.25"/>-->
        <!--<pose x="-0.06" y="0.2" z="0" alpha="0" beta="0" gamma="90"/>-->
        <!--<physics>-->
        <!--<mass kg="2"/>-->
        <!--</physics>-->
        <!--</box>-->

        <!-- MUSCLE ENDINGS: LEFT SIDE - FRONT -->

        <!-- TODO: Correct positions for "tendons". But it looks like it's not necessary.
             The constraint puts them in place. -->
        <!-- Model for iliopsoas -->
        <sphere name="muscle_base_hip_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="1.055"/>
          <physics>
            <mass kg="5"/> <!--Too little weight makes it too prone to perturbations.-->
          </physics>
        </sphere>
        <sphere name="muscle_end_thigh_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.02" y="-0.172" z="0.5"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- Model for quadriceps -->
        <sphere name="muscle_base_thigh_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="0"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>
        <sphere name="muscle_end_shank_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="1.055"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- Model for tibialis anterior -->
        <sphere name="muscle_base_shank_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="1.055"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>
        <sphere name="muscle_end_foot_front_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="0.015"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- MUSCLE ENDINGS: LEFT SIDE - BACK -->


        <!-- Model for gluteus maximus -->
        <sphere name="muscle_base_hip_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="0.1" y="-0.172" z="1.055"/>
          <physics>
            <mass kg="5"/> <!--Too little weight makes it too prone to perturbations.-->
          </physics>
        </sphere>
        <sphere name="muscle_end_thigh_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.02" y="-0.172" z="0.5"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- Model for biceps femoris -->
        <sphere name="muscle_base_thigh_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="0.1" y="-0.172" z="0"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>
        <sphere name="muscle_end_shank_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="0.1" y="-0.172" z="1.055"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- Model for tibialis posterior -->
        <sphere name="muscle_base_shank_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="0.1" y="-0.172" z="0.5"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>
        <sphere name="muscle_end_foot_back_left" visualise="true">
          <dimension radius="0.01"/>
          <pose x="-0.1" y="-0.172" z="0.015"/>
          <physics>
            <mass kg="5"/>
          </physics>
        </sphere>

        <!-- RIGHT SIDE: TODO -->

      </body>

      <pose z="0.015"/> <!-- Elevate robot so it's not inside the ground. -->

      <actuators>
        <!-- JOINTS -->

        <!-- TODO: Change to spherical joint later? It would be the -->
        <!-- btPoint2PointConstraint. -->
        <hinge name="hip_left" type="angular" mode="passive">
          <source      name="hip"/>
          <destination name="thigh_left"/>
          <force       max="1.0"/>
          <velocity    max="1.0"/>
          <!-- y-position is hip-radius + 0.005m because there is 0.01m gap for joints -->
          <pose        x="0" y="-0.105" z="0.172" alpha="0" beta="90" gamma="90"/>
          <deflection  min="-90" max="170"/>
          <!-- <regular     softness="1.0" damping="1.0" restitution="0.7"/> -->
          <!-- <limit       softness="1.0" damping="1.0" restitution="0.7"/> -->
          <!-- <orthogonal  softness="1.0" damping="1.0" restitution="0.7"/> -->
          <!-- <pid         p="0.9" i="0.0" d="0.0" size="1"/> -->
        </hinge>
        <hinge name="knee_left" type="angular" mode="passive">
          <source      name="thigh_left"/>
          <destination name="shank_left"/>
          <force       max="1.0"/>
          <velocity    max="1.0"/>
          <pose        x="0" y="0" z="-0.226" alpha="0" beta="0" gamma="90"/>
          <deflection  min="-150" max="5"/>
        </hinge>
        <hinge name="ankle_left" type="angular" mode="passive">
          <source      name="shank_left"/>
          <destination name="foot_left"/>
          <force       max="1.0"/>
          <velocity    max="1.0"/>
          <pose        x="0" y="0" z="-0.2165" alpha="0" beta="0" gamma="90"/>
          <deflection  min="-90" max="20"/>
        </hinge>

        <!-- MUSCLE ENDINGS: LEFT SIDE - FRONT -->

        <!-- Model for iliopsoas -->
        <pointConstraint name="constraint_base_hip_front_left" mode="muscle">
          <source name="hip"/>
          <destination name="muscle_base_hip_front_left"/>
          <pose x="-0.1" y="0" z="0.172"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_thigh_front_left" mode="muscle">
          <source name="thigh_left"/>
          <destination name="muscle_end_thigh_front_left"/>
          <pose x="-0.02" y="0" z="0.1"/>
        </pointConstraint>

        <!-- Model for quadricep -->
        <pointConstraint name="constraint_base_thigh_front_left" mode="muscle">
          <source name="thigh_left"/>
          <destination name="muscle_base_thigh_front_left"/>
          <pose x="-0.02" y="0" z="0.05"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_shank_front_left" mode="muscle">
          <source name="shank_left"/>
          <destination name="muscle_end_shank_front_left"/>
          <pose x="-0.02" y="0" z="0.2"/> <!-- Upper patella -->
        </pointConstraint>

        <!-- Model for tibialis anterior -->
        <pointConstraint name="constraint_base_shank_front_left" mode="muscle">
          <source name="shank_left"/>
          <destination name="muscle_base_shank_front_left"/>
          <pose x="-0.02" y="0" z="0.17"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_foot_front_left" mode="muscle">
          <source name="foot_left"/>
          <destination name="muscle_end_foot_front_left"/>
          <pose x="0" y="-0.02" z="0.015"/>
        </pointConstraint>

        <!-- MUSCLE ENDINGS: LEFT SIDE - BACK -->

        <!-- Model for gluteus maximus -->
        <pointConstraint name="constraint_base_hip_back_left" mode="muscle">
          <source name="hip"/>
          <destination name="muscle_base_hip_back_left"/>
          <pose x="0.1" y="0" z="0.172"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_thigh_back_left" mode="muscle">
          <source name="thigh_left"/>
          <destination name="muscle_end_thigh_back_left"/>
          <pose x="0.02" y="0" z="0.1"/>
        </pointConstraint>

        <!-- Model for biceps femoris -->
        <pointConstraint name="constraint_base_thigh_back_left" mode="muscle">
          <source name="thigh_left"/>
          <destination name="muscle_base_thigh_back_left"/>
          <pose x="0.02" y="0" z="0.05"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_shank_back_left" mode="muscle">
          <source name="shank_left"/>
          <destination name="muscle_end_shank_back_left"/>
          <pose x="0.02" y="0" z="0.2"/> <!-- Upper patella -->
        </pointConstraint>

        <!-- Model for tibialis posterior -->
        <pointConstraint name="constraint_base_shank_back_left" mode="muscle">
          <source name="shank_left"/>
          <destination name="muscle_base_shank_back_left"/>
          <pose x="0.02" y="0" z="0.17"/>
        </pointConstraint>
        <pointConstraint name="constraint_end_foot_back_left" mode="muscle">
          <source name="foot_left"/>
          <destination name="muscle_end_foot_back_left"/>
          <pose x="0" y="-0.14575" z="0.015"/>
        </pointConstraint>


        <!-- MUSCLE ENDINGS: RIGHT SIDE - FRONT -->

        <!-- <pointConstraint name="constraint_base_hip_front_right" mode="muscle"> -->
        <!--   <source name="hip"/> -->
        <!--   <destination name="muscle_base_hip_front_right"/> -->
        <!--   <pose x="-0.1" y="0" z="-0.172"/> -->
        <!-- </pointConstraint> -->

        <!-- MUSCLE ENDINGS: RIGHT SIDE - BACK -->


        <!-- MUSCLES: LEFT - FRONT -->

        <!-- Model for iliopsoas -->
        <muscle name="muscle_hip_front_left" type="hill">
          <source name="muscle_base_hip_front_left"/>
          <destination name="muscle_end_thigh_front_left"/>
          <force max="10"/>
          <velocity max="10"/>
          <mapping min="-1.0" max="1.0"/>
          <force-length_model model="linear"/>
          <force-velocity_model model="linear"/>
        </muscle>

        <!-- Model for quadricep -->
        <!-- <muscle name="muscle_thigh_front_left" type="hill"> -->
        <!--   <source name="muscle_base_thigh_front_left"/> -->
        <!--   <destination name="muscle_end_shank_front_left"/> -->
        <!--   <force max="10"/> -->
        <!--   <velocity max="10"/> -->
        <!--   <mapping min="-1.0" max="1.0"/> -->
        <!--   <force-length_model model="linear"/> -->
        <!--   <force-velocity_model model="linear"/> -->
        <!-- </muscle> -->

        <!-- Model for tibialis anterior -->
        <!-- <muscle name="muscle_shank_front_left" type="hill"> -->
        <!-- <source name="muscle_base_shank_front_left"/> -->
        <!-- <destination name="muscle_end_foot_front_left"/> -->
        <!-- <force max="10"/> -->
        <!-- <velocity max="10"/> -->
        <!-- <mapping min="-1.0" max="1.0"/> -->
        <!-- <force-length_model model="linear"/> -->
        <!-- <force-velocity_model model="linear"/> -->
        <!-- </muscle> -->

        <!-- MUSCLES: LEFT - BACK -->

        <!-- Model for gluteus maximus -->
        <!-- <muscle name="muscle_hip_back_left" type="hill"> -->
        <!--   <source name="muscle_base_hip_back_left"/> -->
        <!--   <destination name="muscle_end_thigh_back_left"/> -->
        <!--   <force max="10"/> -->
        <!--   <velocity max="10"/> -->
        <!--   <mapping min="-1.0" max="1.0"/> -->
        <!--   <force-length_model model="linear"/> -->
        <!--   <force-velocity_model model="linear"/> -->
        <!-- </muscle> -->

        <!-- Model for biceps femoris -->
        <!-- <muscle name="muscle_thigh_back_left" type="hill"> -->
        <!--   <source name="muscle_base_thigh_back_left"/> -->
        <!--   <destination name="muscle_end_shank_back_left"/> -->
        <!--   <force max="10"/> -->
        <!--   <velocity max="10"/> -->
        <!--   <mapping min="-1.0" max="1.0"/> -->
        <!--   <force-length_model model="linear"/> -->
        <!--   <force-velocity_model model="linear"/> -->
        <!-- </muscle> -->

        <!-- Model for tibialis posterior -->
        <!--<muscle name="muscle_shank_back_left" type="hill">-->
          <!--<source name="muscle_base_shank_back_left"/>-->
          <!--<destination name="muscle_end_foot_back_left"/>-->
          <!--<force max="10"/>-->
          <!--<velocity max="10"/>-->
          <!--<mapping min="-1.0" max="1.0"/>-->
          <!--<force-length_model model="linear"/>-->
          <!--<force-velocity_model model="linear"/>-->
        <!--</muscle> -->

      </actuators>


      <sensors>

        <!-- TODO: Sensoren für Muskeln? Spaeter evtl. -->

        <deflection name="hip_left_sensor">
          <object   name="hip_left"/>
          <domain   min="-90" max="170"/>
          <mapping  min="-1"  max="1"/>
        </deflection>
        <deflection name="knee_left_sensor">
          <object   name="knee_left"/>
          <domain   min="-150" max="5"/>
          <mapping  min="-1"  max="1"/>
        </deflection>
        <deflection name="ankle_left_sensor">
          <object   name="ankle_left"/>
          <domain   min="-90" max="20"/>
          <mapping  min="-1"  max="1"/>
        </deflection>
        <binaryContact name="foot_left_sensor">
          <object name="foot_left"/>
          <domain min="-1" max="1"/>
        </binaryContact>

        <position name="xyz_position_main">
          <object name="hip"/>
          <coordinates x="true" y="true" z="true"/>
        </position>
        <orientation name="xyz_orientation_main">
          <object name="hip"/>
          <coordinates x="true" y="true" z="true"/>
        </orientation>

      </sensors>

      <controller module="TCPIP" frequency="10"/>
      <!--<controller module="Sine" frequency="10"/>-->

    </robot>
  </robots>

  <!--<logging>-->
    <!--<object target="anchor" precision="3"> <use value="x"/> <use value="y"/> </object>-->
    <!--<object target="sphere" precision="3"> <use value="x"/> <use value="y"/> </object>-->

    <!--<actuator target="muscle" precision="3"> <internal/> <external/> <desired/> <appliedForce/> <appliedVelocity/> </actuator>-->

    <!--<console>-->
      <!--<target name="sphere"/>-->
      <!--<target name="muscle"/>-->
    <!--</console>-->

    <!--<gnuplot size="100000" delay="100" pairwise="true">-->
      <!--<target name="sphere"/>-->
      <!--<target name="muscle"/>-->
    <!--</gnuplot><]-->

    <!--<file name="muscle_log">-->
      <!--<target name="sphere"/>-->
      <!--<target name="muscle"/>-->
    <!--</file>-->

    <!--<csv name="muscle_log">-->
      <!--<target name="sphere"/>-->
      <!--<target name="muscle"/>-->
    <!--</csv>-->

    <!--<blender name="muscle_log.csv" cfg="cibraitenberg_blender.cfg" framerate="10"/>-->
    <!--<blender name="muscle_log.txt"/>-->
  <!--</logging>-->

</rosiml>
